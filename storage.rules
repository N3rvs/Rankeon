
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // Avatares de usuarios
    match /avatars/{userId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && (request.auth.uid == userId || request.auth.token.role == 'admin');
    }

    // Avatares de equipos
    match /teams/{teamId}/avatar/{fileName} {
      allow read: if request.auth != null;
      // Permite la escritura si el usuario es el fundador del equipo o un administrador.
      allow write: if request.auth != null && (firestore.get(/databases/(default)/documents/teams/$(teamId)).data.founder == request.auth.uid || request.auth.token.role == 'admin');
    }

    // Banners de equipos
    match /teams/{teamId}/banner/{fileName} {
      allow read: if request.auth != null;
      // Permite la escritura si el usuario es el fundador del equipo o un administrador.
      allow write: if request.auth != null && (firestore.get(/databases/(default)/documents/teams/$(teamId)).data.founder == request.auth.uid || request.auth.token.role == 'admin');
    }

    // Denegar todo lo dem√°s por seguridad
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
